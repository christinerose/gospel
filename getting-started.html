
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Getting started &#8212; Gospel 0.1.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Walk-through" href="walkthrough.html" />
    <link rel="prev" title="Welcome to Gospel’s documentation!" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="getting-started">
<h1>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<div class="section" id="installing-gospel">
<h2>Installing Gospel<a class="headerlink" href="#installing-gospel" title="Permalink to this headline">¶</a></h2>
<p>Please make sure that you already have a decently recent version of
<code class="docutils literal notranslate"><span class="pre">ocaml</span></code> and <code class="docutils literal notranslate"><span class="pre">opam</span></code> installed. Gospel requires the following
versions:</p>
<ul class="simple">
<li><p>OCaml 4.09.0 or newer</p></li>
<li><p>Opam 2.0 or newer</p></li>
</ul>
<p>Please visit <a class="reference external" href="https://ocaml.org/learn/tutorials/up_and_running.html">ocaml.org</a> for instructions on
how to get started with your OCaml environment.</p>
<p>Gospel is available on Opam repositories. Installing it is straightforward:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ opam install gospel
</pre></div>
</div>
<p>This will install the <code class="docutils literal notranslate"><span class="pre">gospel</span></code> tool binary, as well as the developer library if you
wish to build your software on top of Gospel. You may check the installation with:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ gospel --version
gospel version <span class="m">0</span>.1.0
</pre></div>
</div>
</div>
<div class="section" id="your-first-specification">
<h2>Your first specification<a class="headerlink" href="#your-first-specification" title="Permalink to this headline">¶</a></h2>
<p>Let us get started with a simple specification example, and specify a generic
interface for polymorphic, limited capacity containers:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
<span class="c">(** The type for containers. *)</span>

<span class="k">exception</span> <span class="nc">Full</span>

<span class="k">val</span> <span class="n">create</span><span class="o">:</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
<span class="c">(** [create capacity] is an empty container which maximum capacity</span>
<span class="c">    is [capacity]. *)</span>

<span class="k">val</span> <span class="n">is_empty</span><span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">bool</span>
<span class="c">(** [is_empty t] is [true] iff [t] contains no elements. *)</span>

<span class="k">val</span> <span class="n">clear</span><span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">unit</span>
<span class="c">(** [clear t] removes all values in [t]. *)</span>

<span class="k">val</span> <span class="n">add</span><span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="kt">unit</span>
<span class="c">(** [add t x] adds [x] to the container [t], or raises [Full] if</span>
<span class="c">    [t] has reached its maximum capacity. *)</span>

<span class="k">val</span> <span class="n">mem</span><span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="kt">bool</span>
<span class="c">(** [mem t x] is [true] iff [t] contains [x]. *)</span>
</pre></div>
</div>
<p>Gospel specifications live in special comments, starting with the <code class="docutils literal notranslate"><span class="pre">&#64;</span></code>
character. These comments may be attached to type declarations or value
declarations. They provide a specification for the signature item they are
attached to.</p>
<p>Let’s start by specifying the abstract type <code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">t</span></code>. As a container with fixed
capacity, we can model it with two bits of information: a fixed integer
capacity, and a set of <code class="docutils literal notranslate"><span class="pre">'a</span></code> values, representing its contents. Note that the
capacity is not mutable, while the contents are. This logical modelisation of
the container directly translates into Gospel:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
<span class="c">(** The type for containers. *)</span>
<span class="c">(*@ model capacity: int</span>
<span class="c">    mutable model contents: &#39;a set *)</span>
</pre></div>
</div>
<p>Notice that documentation comments and Gospel specifications can coexist and
even often help understand each other! However, for the sake of brevity, we will
omit them in the rest of this section.</p>
<p>One may also note that the capacity must be positive, and the number of values
in the <code class="docutils literal notranslate"><span class="pre">contents</span></code> set may not exceed <code class="docutils literal notranslate"><span class="pre">capacity</span></code>. Those are type invariants:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span> <span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span>
 <span class="c">(*@ model capacity: int</span>
<span class="c">     mutable model contents: &#39;a set</span>
<span class="hll"><span class="c">     invariant capacity &gt; 0</span>
</span><span class="hll"><span class="c">     invariant Set.cardinal contents &lt;= capacity *)</span>
</span></pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Set</span></code> module is part of the <a class="reference internal" href="stdlib.html"><span class="doc">Gospel standard library</span></a>.
Although it tries to mimic familiar interfaces from the OCaml standard library,
those two should not be confused: logical declarations only can appear in
specifications.</p>
<p>Now that we annotated our type with its models and invariants, we can attach
specifications to the functions to show how they interact with the container.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">create</span></code> returns a container when provided a capacity. We may
want to specify three bits of information:</p>
<ul class="simple">
<li><p>The provided capacity is positive.</p></li>
<li><p>The capacity of the returned container is indeed the one received as an
argument.</p></li>
<li><p>The container is empty.</p></li>
</ul>
<p>Let’s write a Gospel formalisation of that contract. The contract starts with a
header that lets us name the arguments and return value (we will call the
argument <code class="docutils literal notranslate"><span class="pre">c</span></code> and the return value <code class="docutils literal notranslate"><span class="pre">t</span></code>) to mention them in the rest of the
specification. The first property is a pre-condition of the function (we use the
keyword <code class="docutils literal notranslate"><span class="pre">requires</span></code>), while the second and third ones are post-conditions (the
keyword is <code class="docutils literal notranslate"><span class="pre">ensures</span></code>):</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">create</span><span class="o">:</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="n">t</span>
<span class="c">(*@ t = create c</span>
<span class="c">    requires c &gt; 0</span>
<span class="c">    ensures t.capacity = c</span>
<span class="c">    ensures t.contents = Set.empty *)</span>
</pre></div>
</div>
<p>Now on to <code class="docutils literal notranslate"><span class="pre">is_empty</span></code> and <code class="docutils literal notranslate"><span class="pre">mem</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">is_empty</span> <span class="pre">t</span></code> is true if and only if <code class="docutils literal notranslate"><span class="pre">t</span></code> is empty; this is a post-condition.
This function also (hopefully) has no side-effect: it does not modify <code class="docutils literal notranslate"><span class="pre">t</span></code> and
does not depend on any internal state. In Gospel’s language, this function is
<em>pure</em>:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">is_empty</span><span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">bool</span>
<span class="c">(*@ b = is_empty t</span>
<span class="c">    pure</span>
<span class="c">    ensures b &lt;-&gt; t.capacity = Set.empty *)</span>
</pre></div>
</div>
<p>The specification for <code class="docutils literal notranslate"><span class="pre">mem</span></code> is similar:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">mem</span><span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="kt">bool</span>
<span class="c">(*@ b = mem t x</span>
<span class="c">    pure</span>
<span class="c">    ensures b &lt;-&gt; Set.mem x t.contents *)</span>
</pre></div>
</div>
<p>Finally, let us specify <code class="docutils literal notranslate"><span class="pre">clear</span></code> and <code class="docutils literal notranslate"><span class="pre">add</span></code>, which are functions
that mutate the container.</p>
<p>Function <code class="docutils literal notranslate"><span class="pre">clear</span></code> removes any element in its argument: it is empty after the call.
Obviously, it modifies the <code class="docutils literal notranslate"><span class="pre">contents</span></code> model of its argument. After its
execution, the container should be empty. Note that we are only allowed to mention
<code class="docutils literal notranslate"><span class="pre">is_empty</span></code> in the specification because it is a pure function; attempting
to use a non-pure OCaml function in a specification will result in a Gospel
error.</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">clear</span><span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">unit</span>
<span class="c">(*@ clear t</span>
<span class="c">    modifies t.contents</span>
<span class="c">    ensures is_empty t *)</span>
</pre></div>
</div>
<p>A first attempt at specifying <code class="docutils literal notranslate"><span class="pre">add</span></code> is similar to the
previous examples. We use Gospel’s <code class="docutils literal notranslate"><span class="pre">old</span></code> primitive to refer to the
state of the container prior to the function execution:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">add</span><span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="kt">unit</span>
<span class="c">(*@ add t x</span>
<span class="c">    modifies t.contents</span>
<span class="c">    ensures t.contents = Set.add x (old t.contents) *)</span>
</pre></div>
</div>
<p>Notice, however, that this specification is incomplete. Indeed, one specificity
of this function is that it can raise <code class="docutils literal notranslate"><span class="pre">Full</span></code>. Let us complete
that contract with this bit of information. If <code class="docutils literal notranslate"><span class="pre">add</span></code> raises <code class="docutils literal notranslate"><span class="pre">Full</span></code>, we can
deduce that <code class="docutils literal notranslate"><span class="pre">t.contents</span></code> already contains <code class="docutils literal notranslate"><span class="pre">t.capacity</span></code> elements.</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span> <span class="k">val</span> <span class="n">add</span><span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="kt">unit</span>
 <span class="c">(*@ add t x</span>
<span class="c">     modifies t.contents</span>
<span class="c">     ensures t.contents = Set.add x (old t.contents)</span>
<span class="hll"><span class="c">     raises Full -&gt; Set.cardinal (old t.contents) = t.capacity</span>
</span><span class="hll"><span class="c">                 /\ t.contents = old t.contents *)</span>
</span></pre></div>
</div>
<p>Since we have a <code class="docutils literal notranslate"><span class="pre">modifies</span></code> clause, the contents of <code class="docutils literal notranslate"><span class="pre">t</span></code> may be
mutated even when <code class="docutils literal notranslate"><span class="pre">Full</span></code> is raised. The last line of specification
forbids such a behavior.</p>
<p>Notice how we did not need to repeat that <code class="docutils literal notranslate"><span class="pre">S.cardinal</span> <span class="pre">t.contents</span> <span class="pre">&lt;=</span>
<span class="pre">t.capacity</span></code> in every contract; as a type invariant, this property implicitely
holds in every function’s pre-state and post-state.</p>
<p>We’re done! Our module interface is fully specified, independently of any
implementation. Let’s finish by verifying that these are well-typed, and call
Gospel’s type-checker:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ gospel check ./container.mli
OK
</pre></div>
</div>
</div>
<div class="section" id="now-what">
<h2>Now what?<a class="headerlink" href="#now-what" title="Permalink to this headline">¶</a></h2>
<p>You’ve written your first specfication. Now what can you do with it?</p>
<p>Well, your specification alone is already helpful, as it completes the
docstring, which may be incomplete or ambiguous, leading to wrong
interpretations of your semantics, or wrong usage of your library.</p>
<p>But besides the <code class="docutils literal notranslate"><span class="pre">gospel</span></code> binary, we also provide a developer API which lets
other tools leverage these specifications to provide different features.
Such tools already exist, and let you benefit from the specification to bring
more guarantees to your programs.</p>
<span class="target" id="index-0"></span><span class="target" id="index-1"></span><div class="section" id="cameleer">
<span id="index-2"></span><h3>Cameleer<a class="headerlink" href="#cameleer" title="Permalink to this headline">¶</a></h3>
<p>Cameleer is a tool for the deductive verification of OCaml code.</p>
<p>It extents Gospel to implementation files, where you may add logical annotations
like logical assertions, loop invariants, or termination arguments. The
verification relies on the <a class="reference external" href="https://why3.lri.fr">Why3</a> framework:
<code class="docutils literal notranslate"><span class="pre">cameleer</span></code> translates the OCaml code into an equivalent WhyML program. It then
lets you analyse this program whithin the framework (and its IDE!) to prove the
assertions via semi-automated techniques based on SMT provers.</p>
<p>For more information, please visit the project page <a class="reference external" href="https://github.com/ocaml-gospel/cameleer">on Github</a>.</p>
<span class="target" id="index-3"></span></div>
<div class="section" id="ortac">
<span id="index-4"></span><h3>Ortac<a class="headerlink" href="#ortac" title="Permalink to this headline">¶</a></h3>
<p>Ortac is a runtime verification tool for OCaml programs.</p>
<p>It reads the Gospel annotations in the interfaces and generates code that
automatically checks them at runtime. It is implementation-agnostic and quite
flexible: you may use it to trigger exceptions when violations occur, monitor
your program execution by logging unexpected events or generate testing suites
and fuzzers.</p>
<p>For more information, please visit the project page <a class="reference external" href="https://github.com/ocaml-gospel/ortac">on Github</a>.</p>
<span class="target" id="index-5"></span><span class="target" id="index-6"></span></div>
<div class="section" id="why3gospel">
<span id="index-7"></span><h3>Why3gospel<a class="headerlink" href="#why3gospel" title="Permalink to this headline">¶</a></h3>
<p>Why3gospel is a <a class="reference external" href="https://why3.lri.fr">Why3</a> plugin that lets you verify that
a program proof refines the Gospel specifications before extracting it to OCaml.</p>
<p>It interfaces the Why3 framework with the Gospel specifications to ensure that
the former refines the latter, guaranteeing that OCaml programs extracted from
proved WhyML indeed comply with their Gospel specification.</p>
<p>For more information, please visit the project page <a class="reference external" href="https://github.com/ocaml-gospel/why3gospel">on Github</a>.</p>
</div>
</div>
<div class="section" id="going-further">
<h2>Going further<a class="headerlink" href="#going-further" title="Permalink to this headline">¶</a></h2>
<p>This tutorial only covered very few features of Gospel. Please feel free to
visit our other resources before getting started:</p>
<ul class="simple">
<li><p>If you like to learn by example, the <a class="reference internal" href="walkthrough.html"><span class="doc">walk-through</span></a> section
contains a gallery of more advanced use-cases extracted from real-world
interfaces. Those should help you familiarize yourself with the process of
formal specification.</p></li>
<li><p>If you prefer to read the manual for more in-depth information on specific
features of the language, you may also visit the <a class="reference internal" href="language.html"><span class="doc">language specification</span></a> section.</p></li>
</ul>
<p>Finally, we are always thrilled to hear your thoughts or questions regarding
Gospel and this tutorial. Please feel free to <a class="reference external" href="https://github.com/ocaml-gospel/gospel/discussions/new">open a discussion</a> and share your
issues and ideas!</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Gospel</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installing-gospel">Installing Gospel</a></li>
<li class="toctree-l2"><a class="reference internal" href="#your-first-specification">Your first specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#now-what">Now what?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#going-further">Going further</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="walkthrough.html">Walk-through</a></li>
<li class="toctree-l1"><a class="reference internal" href="language.html">Language Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="stdlib.html">Standard library</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Related publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="genindex.html">Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Developers</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Welcome to Gospel’s documentation!</a></li>
      <li>Next: <a href="walkthrough.html" title="next chapter">Walk-through</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020—2021, Jean-Christophe Filliâtre, Clément Pascutto, Mário Pereira.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/getting-started.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>